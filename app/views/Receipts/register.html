#{extends 'main.html' /}
#{set title:'Add new receipt' /}
#{set 'moreScripts'}
	#{script 'chosen.jquery.min.js' /}
#{/set}
#{set 'moreStyles'}
	#{stylesheet 'chosen.css' /}
#{/set}

<div id="register">
	
	<h1>Add new receipt</h1>
		
	#{form @add()}
		
		#{if flash.error}
			<p class="error">
				&{flash.error}
			</p>
		#{/if}
		<p id="title-field">
			<label for="title">Title:</label><br/>
			<input type="text" name="title" id="title" value="${flash.title}" />
		</p>
		<p id="description-field">
			<label for="description">Description:</label><br/>
			<textarea name="description" id="description">${flash.description}</textarea>
		</p>
		<p id="tip-field">
			<label for="username">Tip:</label><br/>
			<input type="text" name="tip" id="tip" value="${flash.tip}" />
		</p>
		<p id="members-field">
			<label for="members">Members:</label><br/>
			<select data-placeholder="Choose members..." class="chzn-select" style="width:350px;" id="members" name="members" multiple="yes"> 
				<option value=""></option>
				#{list items:members, as:'user'}
          		<option value="${user.id}">${user.fullname} (${user.username})</option>
          		#{/list}
			</select>
		</p>
		<p id="rounds-field">
			<label for="rounds">Rounds:</label><br/>
			<div id="round_list">
			</div>
			<input type="text" placeholder="New round title" id="round_title" />
			<br/>
			<input type="submit" id="round_add" value="Add" />
		</p>
		<p id="register-field">
			<input type="submit" id="register" value="Save receipt" />
		</p>
	#{/form}
	
	<script type="text/javascript">
		var rounds = 0;
		
		$('#round_add').click(function(event) {
			event.preventDefault();
			
			$('<div id="div_round_' + rounds + '"><h3>' + $('#round_title').val() + '</h3></div><input type="text" placeholder="Member" id="member_' + rounds + '" /><input type="text" placeholder="Amount" id="amount_' + rounds + '" /><br/><input type="submit" id="add_button_' + rounds + '" value="Add" /><br/><br/>')
			.appendTo($('#round_list'));
			
			
			$('#round_title').val('');
			
			$('#add_button_' + rounds).click({round: rounds}, function(event) {
				event.preventDefault();
				$('<span class="member">' + $('#member_' + event.data.round).val() + '</span><span class="amount">' + $('#amount_' + event.data.round).val() + '</span><br/>')
				.appendTo($('#div_round_' + event.data.round));
				
			});
			
			rounds = rounds + 1;
		});
		

	</script> 
	<script type="text/javascript">$(".chzn-select").chosen(); </script> 
</div>