*{ Display a receipt in one of several modes: 'teaser' or 'full' }*

<div class="receipt ${_as == 'teaser' ? 'teaser' : ''}">
	<h2 class="receipt title">
		<a href="@{Receipts.show(_receipt.id)}">${_receipt.title}</a>
	</h2>
	<div class="details">
		<span class="receipt-owner">by ${_receipt.owner.fullname}</span>,
		<span class="receipt-created">${_receipt.created.format('yyyy-MM-dd')}</span>
	</div>
	#{if _as != 'teaser'}
		<div class="receipt-content">
			<div class="about">Details:</div>
			${_receipt.description.nl2br()}
		</div>
	#{/if}
</div>

#{if _as == 'full'}
	<div class="members">
		<h3>
			${_receipt.members.size() ?: 'no'} 
	        member${_receipt.members.size().pluralize()}
		</h3>
	    #{list items:_receipt.members, as:'member'}
            <li class="member">
                ${member.fullname} (${_receipt.getTotal(member)} SEK)
            </li>
	    #{/list}
	</div>
	
	<div class="rounds">
		<h3>Receipt</h3>
		<table class="receipt" cellspacing="0">
			<tr>
				<th>Item</th><th>Special cases</th>
			</tr>
			#{list items:_receipt.subpots, as:'round'}
				<tr>
					<td>${round.description}</td>
					<td>
						#{list items:round.cases, as:'special'}
							${special.user.fullname}: ${special.amount} SEK
							<br/>
						#{/list}
						Rest: ${round.restAmount} SEK
					</td>
				</tr>
			#{/list}
		</table>
		<div class="tip">Tip: ${_receipt.tip} SEK</div>
		<span class="total">Total: ${_receipt.total} SEK</span>
	</div>
		
	<div id="comments" class="comments">
	    <h3>
	        Comments:
	    </h3>

	</div>
	<br/>
	<form class="form-stacked">
		<fieldset>
			<legend>Add new comment</legend> 
			<div class="clearfix"> 
				<div class="input">
					<textarea id="comment-value" class="newComment"></textarea>
				</div>
			</div>
			<div class="actions">
				<input class="btn primary" type="submit" id="postComment" value="Post" onsubmit="return false;"/>
				&nbsp;<button type="reset" class="btn">Cancel</button> 
			</div>
		</fieldset>
	</form>
#{/if}



<script type="text/javascript" charset="utf-8">
var lastTimestamp = 0
var virgin = true;

$(document).ready(function() {
	getPosts();
	setInterval(getPosts, 2000);
});

function getPosts() {
	$.get('@{Comments.get()}', {id: ${_receipt.id}, lastPost: lastTimestamp}, renderPosts, 'json');
	
}

$('#postComment').click(function() {
	$.post('@{Comments.post()}', {id: ${_receipt.id}, content: $('#comment-value').val(), lastPost: lastTimestamp}, renderPosts, 'json');
	return false;
})

function renderPosts(comments) {
	lastTimestamp = attachPosts(comments, buildHtml, '#comments', lastTimestamp, virgin === true);
	virgin = false;
}

function buildHtml(comment) {
	return '<div class="comment round gradient' + (comment.own === true ? ' own' : '') + '"><div class="comment-metadata' + (comment.own === true ? '-own' : '') + '"><span class="comment-poster">'
			+ comment.poster + '</span> says...</div><div class="comment-content">' + comment.content +
			'</div><span class="comment-date">Posted ' + comment.date +
			' from web</span></div>';
}







</script>