#{extends 'main.html' /}
#{set title:'Payments' /}

#{set 'moreScripts'}
	#{script 'jquery.tablesorter.min.js' /}
#{/set}

<script >
  $(function() {
    $("table#sortTableExample").tablesorter({ sortList: [[1,1]] });
  });
</script>

<div class="row">
    <div class="span8 columns">
	    <div class="alert-message block-message error">
	    	<div>
			    <h2>Liabilites</h2>
			    #{displayPayment payments:liabilities, action:'pay', outgoing:true, showDate:false /}
			</div>

		</div>
    </div><!-- /col -->
    <div class="span8 columns">
	    <div class="alert-message block-message success">
	    	<div>
			    <h2>Debt securities</h2>
			    #{displayPayment payments:securities, action:'none', outgoing:false, showDate:false /}
			</div>
		</div>
    </div><!-- /col -->
</div>  

<div class="row">
    <div class="span8 columns">
	    <div class="alert-message block-message error">
			<div>
				<h3>Pending settlements</h3>
				#{displayPayment payments:pending, action:'none', outgoing:true, showDate:true /}
			</div>
		</div>
    </div><!-- /col -->
    <div class="span8 columns">
	    <div class="alert-message block-message success">		
			<div>
				<h3>Accept settlements</h3>
				#{displayPayment payments:accept, action:'accept', outgoing:false, showDate:true /}
			</div>
		</div>
    </div><!-- /col -->
</div>  

<h3>Settled</h3>
<table class="zebra-striped" id="sortTableExample">
    <thead>
      <tr>
        <th class="header">Paid</th>
        <th class="header">Accepted</th>
        <th class="header">From</th>
        <th class="header">To</th>
        <th class="header">Amount</th>
        <th class="header">Id</th>
        <th class="header">Receipts</th>
      </tr>
    </thead>
    <tbody>
	#{list items:settled, as:'payment'}
	%{
    	if(user == payment.payer) color = "red"
    	else color = "green"
    }%
    <tr>
        <td class="${color}">${payment.paid.format('yyyy-MM-dd')}</td>
        <td class="${color}">${payment.accepted.format('yyyy-MM-dd')}</td>
        <td class="${color}">${payment.payer}</td>
        <td class="${color}">${payment.receiver}</td>
        <td class="${color}">${payment.amount}</td>
        <td class="${color}">${payment.identifier}</td>
        <td class="${color}">${payment.receipts.size()}</td>
     </tr>
     #{/list}
     </tbody>
  </table>